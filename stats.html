<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
        
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
		integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
		integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
		
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
	<style>
		.bd-placeholder-img {
			font-size: 1.125rem;
			text-anchor: middle;
			-webkit-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			user-select: none;
		}

		@media (min-width: 768px) {
			.bd-placeholder-img-lg {
				font-size: 3.5rem;
			}
		}
		
		#test backButton {
		border-radius: 4px;
		padding: 8px;
		border: none;
		font-size: 16px;
		background-color: #2eacd1;
		color: white;
		position: absolute;
		cursor: pointer;
	  }
	  .invisible {
		display: none;
	  }
		
	</style>
	<script>
		window.onload = function() {

			var dataTournageReal = [];
			var dataTournageArdt = [];
			var dataTypeTournage = [];
			var dataTypeTournage2 = [];
			var dataTournageMois = [];
			var dataDureeTournage = [];
			var line;
			var mois = ["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Décembre"];
			
			function numberLine(data){
				line = data.nb;
				document.getElementById("NombreTournage").innerHTML=line;
				
			}
			<!-- console.log(line); -->
			
			$.getJSON('http://localhost:444/nombredeligne',numberLine);
			
			//Chart du nombre de tournage par Réalisateur
			var TournageReal = new CanvasJS.Chart("TournageReal", {
			animationEnabled: true, 
			zoomEnabled: true,
			title:{
				text: "Nombre de tournages par réalisateur"
			},
			axisY: {
				title: "Nombre de tournage",
				valueFormatString: "#",
			},
			data: [{
				type: "column",
				color: "rgba(54,158,173,.7)",
				markerSize: 5,
				xValueFormatString: "YYYY",
				yValueFormatString: "# tournages",
				dataPoints: dataTournageReal
			}]
			});

		function DataTournageReal(data) {
			var temp = (Object.getOwnPropertyNames(data.result))
				for (var i = 0; i < data.taille; i++) {
					dataTournageReal.push({
						y : data.result[temp[i]],
						label : temp[i]
					});
				}
				TournageReal.render();
			}
			$.getJSON('http://localhost:444/tournagesparreal',DataTournageReal);
			
			
			<!-- Idée de statistiques: -->
				<!-- - Nombre de tournages par film --> Fait
				<!-- - Nombre de tournages par réalisateur --> Fait
				<!-- - Nombre de tournages par mois --> Fait
				<!-- - Nombre de tournages par arrondissement --> Fait
				<!-- - Nombre de tournages par organisme demandeur --> Fait
				<!-- Durée moyenne d'un tournage -->
				
				
				-->

			
			//Nombre de tournages par arrondissement
			var TournageArrdt = new CanvasJS.Chart("TournageArrdt", {
				animationEnabled: true,
				title:{
					text:"Nombre de tournages par arrondissement"
				},
				axisX:{
					interval: 2
				},
				axisY2:{
					interlacedColor: "rgba(1,77,101,.2)",
					gridColor: "rgba(1,77,101,.1)",
					title: "Nombre de tournages"
				},
				data: [{
					type: "bar",
					name: "Arrondissement",
					axisYType: "secondary",
					color: "#014D65",
					dataPoints: dataTournageArdt
				}]
			});
			
			
			function DataTournageArdt(data) {
			var temp = (Object.getOwnPropertyNames(data.result))
				for (var i = 0; i < data.taille; i++) {
					dataTournageArdt.push({
						y: data.result[temp[i]],
						label : temp[i]
					});
				}
				TournageArrdt.render();
			}
			$.getJSON('http://localhost:444/tournagesparardt',DataTournageArdt);

		
		//Pourcentage de chaque type de tournage
		var TypeTournage = new CanvasJS.Chart("TypeTournage", {
			theme: "light2",
			animationEnabled: true,
			title: {
				text: "Type de Tournage"
			},
			data: [{
				type: "pie",
				startAngle: 240,
				yValueFormatString: "##0.00\"%\"",
				indexLabel: "{label} {y}",
				dataPoints: dataTypeTournage
			}]
		});
		
		function DataTypeTournage(data) {
			var temp = (Object.getOwnPropertyNames(data.result))
				for (var i = 0; i < data.taille; i++) {
					dataTypeTournage.push({
						y: (data.result[temp[i]]/line)*100,
						label : temp[i]
					});
				}
				TypeTournage.render();
			}
			$.getJSON('http://localhost:444/tournagespartype',DataTypeTournage);
		
		var TournageParMois = new CanvasJS.Chart("TournageMois", {
			animationEnabled: true,
			theme: "light2",
			title:{
				text: "Nombre de tournage par mois"
			},
			axisY:{
				includeZero: false
			},
			data: [{        
				type: "splineArea",       
				dataPoints: dataTournageMois
			}]
		});
		
		function DataTournageMois(data) {
			var temp = (Object.getOwnPropertyNames(data.result))
				for (var i = 0; i < 12; i++) {
					dataTournageMois.push({
						y: data.result[temp[i]],
						label : mois[i]
					});
				}
				TournageParMois.render();
			}
			$.getJSON('http://localhost:444/tournagesparmois',DataTournageMois);
		
		
		var DureeTournage = new CanvasJS.Chart("TournageDuree", {
			animationEnabled: true, 
			zoomEnabled: true,
			title:{
				text: "Durée des tournages par nombre de jours"
			},
			axisY: {
				title: "Nombre de tournage",
				valueFormatString: "#",
			},
			axisX: {
				title : "Nombre de Jours",
				valueFormatString: "#",
			},
			data: [{
				type: "column",
				color: "rgba(54,158,173,.7)",
				markerSize: 5,
				xValueFormatString: "YYYY",
				yValueFormatString: "# tournages",
				dataPoints: dataDureeTournage
			}]
			});

		function DataDureeTournage(data) {
			console.log("data",data);
			var temp = (Object.getOwnPropertyNames(data.result))
				console.log("temp",temp);
				for (var i = 0; i < temp.length; i++) {
					if (temp[i]==6){
						dataDureeTournage.push({
							y : data.result[temp[i]],
							label : temp[i]+"+"
					});
					}
					else{
						dataDureeTournage.push({
							y : data.result[temp[i]],
							label : temp[i]
					});
					}
				}
				console.log("dataT", dataDureeTournage);
				DureeTournage.render();
			}
			$.getJSON('http://localhost:444/dureepartournage',DataDureeTournage);
		
		// Fonctions permettant d'afficher le nombre de film, realisateur, organisme et de tournage
		function NombreFilm(data){
		   document.getElementById("NombreDeFilm").innerHTML=data.nb;
		}
		$.getJSON('http://localhost:444/allTitre',NombreFilm);
		
		function NombreOrga(data){
		   document.getElementById("NombreOrganisme").innerHTML=data.nb;
		}
		$.getJSON('http://localhost:444/allorga',NombreOrga);
		
		function NombreReal(data){
		   document.getElementById("NombreReal").innerHTML=data.nb;
		}
		$.getJSON('http://localhost:444/allreal',NombreReal);
		
		
		
	function choix(){
		var liste, texte;
		liste = document.getElementById("ChartChoice");
		texte = liste.options[liste.selectedIndex].text;
		console.log(texte);
		
		if(texte == 'Nombre de Tournage par Réalisateur'){
			document.getElementById('TournageReal').style.display='block';
			document.getElementById('TournageArrdt').style.display='none';
			document.getElementById('TypeTournage').style.display='none';
		}
		if(texte == 'Nombre de Tournage par Arrondissement'){
			document.getElementById('TournageArrdt').style.display='block';
			document.getElementById('TournageReal').style.display='none';
			document.getElementById('TypeTournage').style.display='none';
		}
		if(texte == 'Différents types de tournages'){
			document.getElementById('TypeTournage').style.display='block';
			document.getElementById('TournageReal').style.display='none';
			document.getElementById('TournageArrdt').style.display='none';
		}
	}
	
	function DataTypeTournage2(data) {
			var temp = (Object.getOwnPropertyNames(data.result));
				for (var i = 0; i < data.taille; i++) {
					dataTypeTournage2.push({
						y: (data.result[temp[i]]/line)*100,
						label : temp[i]
					});
				}
			chart.render();
			}
	$.getJSON('http://localhost:444/tournagespartype',DataTypeTournage2);
		
	var dataLongm=[];
	var dataTelef = [];
	var dataSerie = [];
	var dataSansType = [];
	var dataT= [dataLongm,dataTelef,dataSerie,dataSansType];
	
	
	function DataTypeParMois(data){
		<!-- console.log("yayyaaaaa",data); -->
		var temp = (Object.getOwnPropertyNames(data));
		<!-- console.log("merci",temp); -->
		for (var i=0;i<temp.length;i++){
			<!-- console.log(temp[i]); -->
			<!-- console.log(dataT[i]); -->
			var result = temp[i];
			var temp2 = (Object.getOwnPropertyNames(data[result]));
			<!-- console.log("JC",temp2); -->
			for (j=0;j<temp2.length;j++){
				<!-- console.log(data[result][temp2[j]]); -->
				dataT[i].push({
					y:data[result][temp2[j]],
					label: mois[j]
					});
			}
			                       
			}
		
		}
	
	$.getJSON('http://localhost:444/tournagesparmoispartype', DataTypeParMois)		
			
	var totalVisitors = 883000;
	var visitorsData = {
		"TournageType": [{
			click: visitorsChartDrilldownHandler,
			cursor: "pointer",
			explodeOnClick: false,
			innerRadius: "75%",
			legendMarkerType: "square",
			name: "Nombre de Tournage par Type",
			radius: "100%",
			showInLegend: true,
			startAngle: 90,
			type: "doughnut",
			dataPoints: dataTypeTournage2
		}],
		"LONG METRAGE": [{
			color: "#E7823A",
			name: "LONG METRAGE",
			type: "column",
			dataPoints: dataLongm
		}],
		"SERIE TELEVISEE": [{
			color: "#546BC1",
			name: "SERIE TELEVISEE",
			type: "column",
			dataPoints: dataSerie
		}],
		"TELEFILM": [{
			color: "#546BC1",
			name: "TELEFILM",
			type: "column",
			dataPoints: dataTelef
		}],
		"": [{
			color: "#546BC1",
			name: "",
			type: "column",
			dataPoints: dataSansType
		}]
	};

	var TypeTournageOptions = {
		animationEnabled: true,
		theme: "light2",
		title: {
			text: "Nombre de tournage par type"
		},
		subtitles: [{
			text: "Click on Any Segment to Drilldown",
			backgroundColor: "#2eacd1",
			fontSize: 16,
			fontColor: "white",
			padding: 5
		}],
		legend: {
			fontFamily: "calibri",
			fontSize: 14,
		},
		data: []
	};

	var visitorsDrilldownedChartOptions = {
		animationEnabled: true,
		theme: "light2",
		axisX: {
			labelFontColor: "#717171",
			lineColor: "#a2a2a2",
			tickColor: "#a2a2a2"
		},
		axisY: {
			gridThickness: 0,
			includeZero: false,
			labelFontColor: "#717171",
			lineColor: "#a2a2a2",
			tickColor: "#a2a2a2",
			lineThickness: 1
		},
		data: []
	};

	var chart = new CanvasJS.Chart("chartContainer", TypeTournageOptions);
	chart.options.data = visitorsData["TournageType"];
	

	function visitorsChartDrilldownHandler(e) {
		console.log(e);
		chart2 = new CanvasJS.Chart("chartContainer", visitorsDrilldownedChartOptions);
		chart2.options.data = visitorsData[e.dataPoint.label];
		console.log(e.name);
		chart2.options.title = { text: e.dataPoint.label }
		chart2.render();
		$("#backButton").toggleClass("invisible");
	}

	$("#backButton").click(function() { 
		$(this).toggleClass("invisible");
		chart = new CanvasJS.Chart("chartContainer", TypeTournageOptions);
		chart.options.data = visitorsData["TournageType"];
		chart.render();
	});

	}
	</script>
	<style>
	
	</style>
	<script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>


	<style data-styled-components=""></style>
</head>

<body >
<header>
	<h2><a href="http://localhost:444/" role="button"><i class="fas fa-arrow-circle-left"></i> &nbsp;Retour à la carte</a>
	</h2>
	<h1 class="text-center"> Analyse des données sur les tournages à Paris en 2016 </h1>
</header>	

<div class="container fill">
	<div class="row">
		
		<div class="col">
			<div class="card text-center">
			  <div class="card-body">
				<h5 class="card-header">
					Nombre de Tournage			
					</h5>
				<p class="card-text" id="NombreTournage"></p>
			  </div>
			</div>
		</div>
		<div class="col">
			<div class="card text-center" >
			  <div class="card-body">
				<h5 class="card-header">Nombre de Réalisateur</h5>
				<p class="card-text" id="NombreReal"></p>
			  </div>
			</div>
		</div>
		<div class="col">
			<div class="card text-center">
			  <div class="card-body">
				<h5 class="card-header">Nombre d'Organisme Demandeur</h5>
				<p class="card-text" id="NombreOrganisme"></p>
			  </div>
			</div>
		</div>
		<div class="col">
			<div class="card text-center">
			  <div class="card-body">
				<h5 class="card-header">Nombre de Films</h5>
				<p class="card-text" id="NombreDeFilm"></p>
			  </div>
			</div>
		</div>
	</div>

<div id="TournageReal" style="height: 370px; width: 100%;"></div>
<div id="TournageArrdt" style="height: 370px; width: 100%;"></div>
<div id="TypeTournage" style="height: 370px; width: 100%;"></div>

<div id="test">
<div id="chartContainer" style="height: 370px; width: 100%;"> </div>
<button class="btn invisible" id="backButton">< Back</button>
</div>

<div id="TournageMois" style="height: 370px; width: 100%;"></div>
<div id="TournageDuree" style="height: 370px; width: 100%;"></div>
</div>


	<script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
		integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
		crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
		integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
		crossorigin="anonymous"></script>

</body>

</html>